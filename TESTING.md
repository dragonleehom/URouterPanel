# URouterOS 功能验证清单

本文档提供详细的功能验证步骤,帮助您在物理硬件上逐个测试Web管理界面的所有功能。

**验证环境**: 物理路由器硬件 (Ubuntu + URouterOS)  
**访问地址**: http://192.168.188.1:3000

---

## 📋 验证前准备

### 1. 确认服务运行状态

```bash
# SSH连接到路由器
ssh root@192.168.188.1

# 检查服务状态
sudo systemctl status urouteros

# 查看实时日志
sudo journalctl -u urouteros -f
```

**预期结果**: 服务状态为 `active (running)`,无错误日志

### 2. 访问Web界面

浏览器打开: http://192.168.188.1:3000

**预期结果**: 能正常加载仪表盘页面,显示系统状态

---

## 🧪 功能验证清单

### ✅ 模块1: 网络接口配置

#### 测试1.1: 查看现有接口列表

**操作步骤**:
1. 点击左侧菜单 "网络管理" → "接口配置"
2. 查看接口列表

**预期结果**:
- [ ] 显示所有网络接口(如eth0, eth1等)
- [ ] 显示接口类型(WAN/LAN)
- [ ] 显示协议类型(static/dhcp/pppoe)
- [ ] 显示IP地址、状态等信息

**如果失败,请提供**:
- 截图: 接口列表页面
- 错误信息: 浏览器控制台(F12)的错误
- 后端日志: `sudo journalctl -u urouteros -n 100`

---

#### 测试1.2: 编辑接口配置(静态IP)

**操作步骤**:
1. 点击某个LAN接口的"编辑"按钮
2. 修改以下配置:
   - 协议: Static
   - IP地址: 192.168.100.1
   - 子网掩码: 255.255.255.0
   - 网关: (留空)
3. 点击"保存"按钮(不点"保存并应用")

**预期结果**:
- [ ] 配置成功保存
- [ ] 显示"待应用"状态标记
- [ ] 系统实际配置未改变(运行`ip addr show`确认)

**如果失败,请提供**:
- 错误提示信息
- 浏览器控制台错误
- 后端日志中包含"updatePort"的行

---

#### 测试1.3: 应用接口配置

**操作步骤**:
1. 点击"应用配置"按钮
2. 等待应用完成(约3-5秒)

**预期结果**:
- [ ] 显示"应用成功"提示
- [ ] "待应用"标记消失
- [ ] 系统实际配置已更改:
  ```bash
  ip addr show eth1  # 应显示新IP 192.168.100.1
  ```

**如果失败,请提供**:
- 错误提示信息
- 后端日志中包含"applyInterfaceConfig"的行
- 运行 `ip addr show` 的输出

---

#### 测试1.4: 复位未应用的配置

**操作步骤**:
1. 再次编辑接口,修改IP为 192.168.200.1
2. 点击"保存"(不应用)
3. 点击"复位"按钮

**预期结果**:
- [ ] 配置恢复到上次应用的状态(192.168.100.1)
- [ ] "待应用"标记消失

---

### ✅ 模块2: DHCP静态租约

#### 测试2.1: 查看DHCP静态租约列表

**操作步骤**:
1. 点击左侧菜单 "网络管理" → "DHCP/DNS"
2. 点击"DHCP静态租约"标签页

**预期结果**:
- [ ] 显示静态租约列表(可能为空)
- [ ] 显示"添加"按钮

---

#### 测试2.2: 添加DHCP静态租约

**操作步骤**:
1. 点击"添加静态租约"按钮
2. 填写以下信息:
   - MAC地址: `aa:bb:cc:dd:ee:ff`
   - IP地址: `192.168.188.100`
   - 主机名: `test-device`
3. 点击"保存"

**预期结果**:
- [ ] 静态租约添加成功
- [ ] 列表中显示新租约,状态为"待应用"

---

#### 测试2.3: 应用DHCP静态租约配置

**操作步骤**:
1. 点击"应用配置"按钮
2. 等待应用完成

**预期结果**:
- [ ] 显示"应用成功"提示
- [ ] 状态变为"已应用"
- [ ] dnsmasq配置文件已更新:
  ```bash
  cat /etc/dnsmasq.d/static-leases.conf
  # 应包含: dhcp-host=aa:bb:cc:dd:ee:ff,192.168.188.100,test-device
  ```
- [ ] dnsmasq服务已重启:
  ```bash
  sudo systemctl status dnsmasq
  ```

**如果失败,请提供**:
- 错误提示信息
- 后端日志中包含"dhcpStaticLeaseApplier"的行
- `/etc/dnsmasq.d/static-leases.conf` 文件内容

---

#### 测试2.4: 删除DHCP静态租约

**操作步骤**:
1. 点击刚添加的租约的"删除"按钮
2. 确认删除
3. 点击"应用配置"

**预期结果**:
- [ ] 租约从列表中删除
- [ ] dnsmasq配置文件已更新(不再包含该租约)

---

### ✅ 模块3: DNS转发器配置

#### 测试3.1: 查看当前DNS配置

**操作步骤**:
1. 点击左侧菜单 "网络管理" → "DHCP/DNS"
2. 点击"DNS转发器"标签页
3. 点击"显示当前系统DNS"按钮

**预期结果**:
- [ ] 显示当前系统使用的DNS服务器列表

---

#### 测试3.2: 添加DNS转发器

**操作步骤**:
1. 点击"添加DNS"按钮
2. 填写DNS地址: `8.8.8.8`
3. 设置优先级: `10`
4. 点击"保存"
5. 重复添加: `8.8.4.4` (优先级20)

**预期结果**:
- [ ] DNS服务器添加成功
- [ ] 按优先级排序显示

---

#### 测试3.3: 批量导入常用DNS

**操作步骤**:
1. 点击"批量导入"按钮
2. 选择"Google DNS"
3. 确认导入

**预期结果**:
- [ ] 自动添加Google DNS服务器(8.8.8.8, 8.8.4.4)

---

#### 测试3.4: 应用DNS配置

**操作步骤**:
1. 点击"应用配置"按钮
2. 等待应用完成

**预期结果**:
- [ ] 显示"应用成功"提示
- [ ] dnsmasq配置文件已更新:
  ```bash
  cat /etc/dnsmasq.d/dns-forwarders.conf
  # 应包含: server=8.8.8.8
  ```
- [ ] DNS解析正常工作:
  ```bash
  nslookup google.com 127.0.0.1
  ```

**如果失败,请提供**:
- 错误提示信息
- 后端日志中包含"dnsForwarderApplier"的行
- `/etc/dnsmasq.d/dns-forwarders.conf` 文件内容

---

### ✅ 模块4: 静态路由配置

#### 测试4.1: 添加静态路由

**操作步骤**:
1. 点击左侧菜单 "网络管理" → "路由管理"
2. 点击"静态路由"标签页
3. 点击"添加路由"按钮
4. 填写以下信息:
   - 目标网络: `10.0.0.0/24`
   - 网关: `192.168.188.254`
   - 接口: `eth0`
   - Metric: `100`
5. 点击"保存"

**预期结果**:
- [ ] 路由添加成功
- [ ] 列表中显示新路由,状态为"待应用"

---

#### 测试4.2: 应用静态路由配置

**操作步骤**:
1. 点击"应用配置"按钮
2. 等待应用完成

**预期结果**:
- [ ] 显示"应用成功"提示
- [ ] 路由表已更新:
  ```bash
  ip route show
  # 应包含: 10.0.0.0/24 via 192.168.188.254 dev eth0 metric 100
  ```

**如果失败,请提供**:
- 错误提示信息
- 后端日志中包含"staticRouteApplier"的行
- `ip route show` 的输出

---

### ✅ 模块5: 端口转发配置

#### 测试5.1: 添加端口转发规则

**操作步骤**:
1. 点击左侧菜单 "网络管理" → "防火墙"
2. 点击"端口转发"标签页
3. 点击"添加规则"按钮
4. 填写以下信息:
   - 名称: `SSH转发`
   - 协议: `TCP`
   - 外部端口: `2222`
   - 内部IP: `192.168.188.10`
   - 内部端口: `22`
5. 点击"保存"

**预期结果**:
- [ ] 规则添加成功
- [ ] 列表中显示新规则,状态为"待应用"

---

#### 测试5.2: 应用端口转发配置

**操作步骤**:
1. 点击"应用配置"按钮
2. 等待应用完成

**预期结果**:
- [ ] 显示"应用成功"提示
- [ ] iptables规则已添加:
  ```bash
  sudo iptables -t nat -L UROUTEROS_PORTFORWARD -n -v
  # 应包含: DNAT tcp dpt:2222 to:192.168.188.10:22
  ```

**如果失败,请提供**:
- 错误提示信息
- 后端日志中包含"portForwardingApplier"的行
- `sudo iptables -t nat -L -n -v` 的输出

---

### ✅ 模块6: 防火墙自定义规则

#### 测试6.1: 添加防火墙规则

**操作步骤**:
1. 点击左侧菜单 "网络管理" → "防火墙"
2. 点击"自定义规则"标签页
3. 点击"添加规则"按钮
4. 填写以下信息:
   - 名称: `阻止特定IP`
   - 源IP: `192.168.188.99`
   - 动作: `DROP`
   - 优先级: `100`
5. 点击"保存"

**预期结果**:
- [ ] 规则添加成功
- [ ] 列表中显示新规则,状态为"待应用"

---

#### 测试6.2: 应用防火墙规则

**操作步骤**:
1. 点击"应用配置"按钮
2. 等待应用完成

**预期结果**:
- [ ] 显示"应用成功"提示
- [ ] iptables规则已添加:
  ```bash
  sudo iptables -L UROUTEROS_CUSTOM -n -v
  # 应包含: DROP all -- 192.168.188.99 anywhere
  ```

**如果失败,请提供**:
- 错误提示信息
- 后端日志中包含"firewallRuleApplier"的行
- `sudo iptables -L -n -v` 的输出

---

### ✅ 模块7: 网络诊断工具

#### 测试7.1: Ping工具

**操作步骤**:
1. 点击左侧菜单 "网络管理" → "网络诊断"
2. 选择"Ping"标签页
3. 填写目标地址: `8.8.8.8`
4. 数据包数量: `4`
5. 点击"开始Ping"

**预期结果**:
- [ ] 显示实时Ping输出
- [ ] 显示统计信息(发送/接收/丢包率/平均延迟)

**如果失败,请提供**:
- 错误提示信息
- 后端日志中包含"ping"的行

---

#### 测试7.2: Traceroute工具

**操作步骤**:
1. 选择"Traceroute"标签页
2. 填写目标地址: `google.com`
3. 最大跳数: `30`
4. 点击"开始Traceroute"

**预期结果**:
- [ ] 显示路由路径
- [ ] 显示每跳的IP地址和延迟

---

#### 测试7.3: Nslookup工具

**操作步骤**:
1. 选择"Nslookup"标签页
2. 填写域名: `google.com`
3. 点击"查询"

**预期结果**:
- [ ] 显示DNS解析结果
- [ ] 显示IP地址列表

---

## 🐛 问题反馈格式

如果某个功能测试失败,请按以下格式反馈:

```
### 问题标题
[模块名称] - [功能描述] 失败

### 测试编号
测试X.X

### 问题描述
(详细描述问题现象)

### 操作步骤
1. ...
2. ...

### 预期结果
(应该发生什么)

### 实际结果
(实际发生了什么)

### 错误信息
- 浏览器控制台错误: (粘贴F12控制台的错误)
- 后端日志: (粘贴相关日志)

### 系统信息
- Ubuntu版本: (运行 `lsb_release -a`)
- Node.js版本: (运行 `node --version`)
- 数据库版本: (运行 `mysql --version`)

### 附件
- 截图: (如果有)
- 配置文件: (如果相关)
```

---

## 📊 验证进度跟踪

使用以下表格跟踪验证进度:

| 模块 | 测试项 | 状态 | 备注 |
|------|--------|------|------|
| 网络接口配置 | 1.1 查看接口列表 | ⬜ 未测试 | |
| 网络接口配置 | 1.2 编辑配置(保存) | ⬜ 未测试 | |
| 网络接口配置 | 1.3 应用配置 | ⬜ 未测试 | |
| 网络接口配置 | 1.4 复位配置 | ⬜ 未测试 | |
| DHCP静态租约 | 2.1 查看列表 | ⬜ 未测试 | |
| DHCP静态租约 | 2.2 添加租约 | ⬜ 未测试 | |
| DHCP静态租约 | 2.3 应用配置 | ⬜ 未测试 | |
| DHCP静态租约 | 2.4 删除租约 | ⬜ 未测试 | |
| DNS转发器 | 3.1 查看当前DNS | ⬜ 未测试 | |
| DNS转发器 | 3.2 添加DNS | ⬜ 未测试 | |
| DNS转发器 | 3.3 批量导入 | ⬜ 未测试 | |
| DNS转发器 | 3.4 应用配置 | ⬜ 未测试 | |
| 静态路由 | 4.1 添加路由 | ⬜ 未测试 | |
| 静态路由 | 4.2 应用配置 | ⬜ 未测试 | |
| 端口转发 | 5.1 添加规则 | ⬜ 未测试 | |
| 端口转发 | 5.2 应用配置 | ⬜ 未测试 | |
| 防火墙规则 | 6.1 添加规则 | ⬜ 未测试 | |
| 防火墙规则 | 6.2 应用配置 | ⬜ 未测试 | |
| 网络诊断 | 7.1 Ping工具 | ⬜ 未测试 | |
| 网络诊断 | 7.2 Traceroute工具 | ⬜ 未测试 | |
| 网络诊断 | 7.3 Nslookup工具 | ⬜ 未测试 | |

状态图例:
- ⬜ 未测试
- ✅ 通过
- ❌ 失败
- ⚠️ 部分通过

---

## 🔧 日志收集脚本

如果需要收集完整的系统日志用于问题排查,运行:

```bash
sudo ./scripts/collect-logs.sh
```

脚本会生成一个包含所有相关日志的压缩包。

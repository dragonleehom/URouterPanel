# URouterOS Root权限运行方案评估

## 两种方案对比

### 方案A: sudo方式(当前方案)
**优点:**
- 符合Linux最小权限原则
- 更细粒度的权限控制
- 审计日志更清晰

**缺点:**
- 需要维护复杂的sudoers配置
- 每个需要权限的命令都要添加sudo前缀
- 代码中充斥大量sudo,可读性差
- 容易遗漏某些命令的sudo,导致运行时错误
- 增加系统调用开销

### 方案B: root运行(推荐方案)
**优点:**
- 代码简洁,无需sudo前缀
- 不会因权限问题导致运行时错误
- 符合路由器系统的行业惯例(OpenWrt, pfSense, RouterOS等都以root运行)
- 简化部署和维护

**缺点:**
- 如果代码有漏洞,攻击者可能获得root权限
- 需要更严格的代码审查

## 安全性分析

### 风险评估
1. **攻击面**: URouterOS是路由器系统,通常部署在局域网内,不直接暴露到公网
2. **用户场景**: 主要用于家庭、企业内网,可信环境
3. **行业惯例**: 主流路由器系统都以root运行
4. **代码质量**: TypeScript + tRPC提供类型安全,降低漏洞风险

### 缓解措施
1. **网络隔离**: 建议只在局域网访问Web界面
2. **输入验证**: 所有用户输入都经过tRPC schema验证
3. **最小化依赖**: 减少第三方依赖,降低供应链攻击风险
4. **定期更新**: 及时更新系统和依赖包

## 结论

**推荐采用方案B(root运行)**

理由:
1. URouterOS是专用路由器系统,需要完全的系统控制权限
2. 符合路由器行业惯例,用户预期
3. 大幅简化代码和维护成本
4. 在可信环境(局域网)部署,安全风险可控
5. 避免因权限配置错误导致功能异常

## 实施计划

1. 移除所有代码中的sudo前缀
2. 更新systemd服务配置,设置User=root
3. 移除setup-sudo.sh脚本
4. 更新文档说明以root运行
5. 在DEPLOYMENT.md中添加安全建议
